with cte as
(
select gold_medal as user_id,
       contest_id
from contests
union
select silver_medal as user_id,
       contest_id
from contests
union
select bronze_medal as user_id,
       contest_id
from contests
), cte2 as
(
select *,
      row_number() over (partition by user_id order by contest_id) as rwn
from cte
), cte3 as
(
select user_id
from cte2
group by user_id, contest_id-rwn
having count(*) >= 3
union
select gold_medal as user_id
from contests
group by gold_medal
having count(*) >= 3
)
select u3.name, u3.mail
from cte3 c3
join users u3
on c3.user_id = u3.user_id
